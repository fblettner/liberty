services:
  pg-test:
    build:
      platforms: 
        - linux/arm64      
      context: ../../.
      dockerfile: ./docker/pg/Dockerfile    
    image:  postgres:16
    ports:
      - 5433:5432
    shm_size: 512mb
    command: |
      postgres
        -c shared_buffers=2GB
        -c track_activity_query_size=1MB
        -c work_mem=256MB
        -c maintenance_work_mem=128MB
        -c max_wal_size=8GB
        -c wal_level=minimal
        -c max_wal_senders=0
        -c synchronous_commit=off
        -c checkpoint_timeout=20min
        -c seq_page_cost=1
        -c random_page_cost=4
        -c cpu_tuple_cost=0.03
        -c cpu_index_tuple_cost=0.005
        -c cpu_operator_cost=0.0025
    volumes:
      - pg-data-test:/var/lib/postgresql/data:Z
    environment:
      - POSTGRES_USER=liberty
      - POSTGRES_PASSWORD=change_on_install
volumes:
  pg-data-test:
    name: pg-data-test

